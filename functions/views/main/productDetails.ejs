
<%- include("../partials/start") %>
<link type="text/css" rel="stylesheet" href="/css/products-details.css" />
<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" />
<%- include("../partials/headBody") %>

<%- include("../partials/header") %>    
    <div class="wrapper">
        <%- include("../partials/sidenav") %>
        <div class="main_content">
            <%- include("../partials/search") %>
            <div class="full-product">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <!-- product -->
                    <div class="product-content product-wrap clearfix product-detail">
                        <div class="row">
                            <div class="col-md-5 col-sm-12 col-xs-12">
                                <div class="product-image">
                                    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                                        <ol class="carousel-indicators">
                                        <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                                        <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                                        <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                                        </ol>
                                        <div class="carousel-inner">
                                        <div class="carousel-item active">
                                            <img class="d-block w-100" src="/images/slide1.jpg" alt="First slide">
                                        </div>
                                        <div class="carousel-item">
                                            <img class="d-block w-100" src="/images/slide2.jpg" alt="Second slide">
                                        </div>
                                        <div class="carousel-item">
                                            <img class="d-block w-100" src="/images/slide3.jpg" alt="Third slide">
                                        </div>
                                        </div>
                                        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Previous</span>
                                        </a>
                                        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Next</span>
                                        </a>
                                    </div>

                                </div>
                            </div>
                            <div class="col-md-7 col-sm-12 col-xs-12">
                                <h2 class="name">
                                    <%= productData.title %>                                    
                                </h2>
                                <hr />
                                <h3 class="price-container">
                                    â‚¹<%= productData.price %>
                                    <small>*includes tax</small>
                                </h3>
                                <input type="hidden" value='<%= productId %>' id='productId'>
                                <div class="certified">
                                    <ul>
                                        <li>
                                            <a href="javascript:void(0);">Certified<span>Quality Assured</span></a>
                                        </li>
                                    </ul>
                                </div>

                                <div class="seller">
                                    <p>Sold by: <a href="javascript:void(0);"><%= sellerDetails.name %></a></p>
                                </div>
                                
                                <hr />

                                <div class="price-quote">
                                    
                                        <%if(subscriber){%>
                                            <a href="/user/seller-profile/<%= productData.uid %>"><button type="button" class="btnPrice">Get Seller Details</button></a>
                                        <%} else{%>
                                            <p>You are not subscriber.</p>
                                            <a href="/pricing"><button type="button" class="btnPrice">Purchase Plans</button></a>
                                        <%}%>
                                        <br/>
                                        <p>This is only For the Users Having Any Active Plan</p>
                                    
                                </div>
                                
                                <!-- <div class="price-quote">
                                    <div class="row">
                                        <h5>Enter Product Quantity</h5>
                                    </div>
                                    <div class="row">
                                        <label for="product-quantity"><strong> Quantity&nbsp; </strong></label>
                                        <input type="text" name="quantity" id="product-quantity" class="quantity-text" placeholder="10">
                                    </div>
                                    <div class="row">
                                        <button type="submit" class="btnPrice">Get Latest Price</button>
                                    </div>
                                </div> -->
                                
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <div class="btn-group pull-right">
                                        
                                        <%if(inWishList){%>
                                            <button class="btn btn-white btn-default" onclick="addToWishlist()"><i class="fas fa-heart" id="fas fa-heart" style="color: red;" ></i> Add to wishlist</button>
                                        <%} else{%>
                                            <button class="btn btn-white btn-default" onclick="addToWishlist()"><i class="fas fa-heart" id="fas fa-heart" style="color: grey;" ></i> Add to wishlist</button>
                                        <%}%>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end product -->
                    <div class="products-section">
                        <div class="tab">
                            <button class="tablinks" onclick="openTab(event, 'product-desc')" id="defaultOpen">Product Description</button>
                            <button class="tablinks" onclick="openTab(event, 'product-spec')">Specifications</button>
                            <button class="tablinks" onclick="openTab(event, 'product-review')">Reviews</button>
                        </div>

                        <div id="product-desc" class="tabcontent">
                            <div>
                                <span class="product_info"><%= productData.desc %><span><br>
                            </div>                                                        
                        </div>

                        <div id="product-spec" class="tabcontent">
                            <div class="row">
                                <div class="col-md-12">
                                    <table class="col-md-12">
                                        <tbody>
                                            <% for (var spec in productData.specs ) { %>
                                                <tr class="row mt-10">
                                                    <td class="col-md-4"><span class="p_specification"><%= spec %></span> </td>
                                                    <td class="col-md-8">
                                                        <ul>
                                                            <li><%- productData.specs[spec] %></li>
                                                        </ul>
                                                    </td>
                                                </tr>
                                              <% } %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div id="product-review" class="tabcontent">

                            <% if (myReview) {%>
                                
                                    <p class="your-review">Your Review</p>
                                    <form method="post" class="well padding-bottom-10" onsubmit="return false;">
                                    <section class='rating-widget'>
                                        <!-- Rating Stars Box -->
                                        <div class='rating-stars text-center'>
                                          <ul id='stars'>
                                            <li class='star' title='Poor' data-value='1'>
                                              <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star' title='Fair' data-value='2'>
                                              <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star' title='Good' data-value='3'>
                                              <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star' title='Excellent' data-value='4'>
                                              <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star' title='WOW!!!' data-value='5'>
                                              <i class='fa fa-star fa-fw'></i>
                                            </li>
                                          </ul>
                                          <p id="rating-warning" style="color: red;"></p>
                                        </div>
                                      </section>
                                      
                                      <input type="hidden" id="rating" value='<%= reviews[reviewed].rating %>' />
                                      <li class="message">
                                        <img src="https://bootdey.com/img/Content/avatar/avatar1.png" class="online" />
                                        <span class="message-text">
                                            <a href="javascript:void(0);" class="username">
                                                <%= reviews[reviewed].name %>
                                                <span class="badge">Purchase Verified</span>
                                                <span class="pull-right">
                                                    <% for (var j = 1; j <= 5; j++) { %>
                                                        <% if (reviews[reviewed].rating>=j) {%>
                                                            <i class="fa fa-star text-primary"></i>
                                                            <%}else{%>
                                                                <i class="fa fa-star text-muted"></i>
                                                            <% } %>
                                                    <%} %>
                                                </span>
                                            </a>
                                            <%= reviews[reviewed].review %>
                                        </span>
                                        <ul class="list-inline font-xs">
                                            <li class="pull-right">
                                                <small class="text-muted pull-right ultra-light"> Posted on : <%= new Date(reviews[reviewed].postedOn._seconds*1000).toDateString() %> </small>
                                            </li>
                                        </ul>
                                    </li>
                                    <br><br>
                                   
                                </form>
                                
                                
                                <%}else{%><form method="post" class="well padding-bottom-10" onsubmit="return false;">
                                    <section class='rating-widget'>
                                        <!-- Rating Stars Box -->
                                        <div class='rating-stars text-center'>
                                          <ul id='stars'>
                                            <li class='star' title='Poor' data-value='1'>
                                              <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star' title='Fair' data-value='2'>
                                              <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star' title='Good' data-value='3'>
                                              <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star' title='Excellent' data-value='4'>
                                              <i class='fa fa-star fa-fw'></i>
                                            </li>
                                            <li class='star' title='WOW!!!' data-value='5'>
                                              <i class='fa fa-star fa-fw'></i>
                                            </li>
                                          </ul>
                                          <p id="rating-warning" style="color: red;"></p>
                                        </div>
                                      </section>
                                      
                                      <input type="hidden" id="rating" value='' />
                                    <textarea rows="2" class="form-control" placeholder="Write a review" id="review" onchange="reviewBox()"></textarea>
                                    <div class="margin-top-10">
                                        <button type="button" class="btn btn-sm btn-primary pull-right" onclick="submitReviewHandler()">
                                            Submit Review
                                        </button>
                                    </div>
                                </form><% } %>
                                
                            
                            <br> <br>
                            <div class="chat-body no-padding profile-message">
                                <ul>
                                    <% if (reviews.length>0) {%>
                                        <% for (var i = 0; i < reviews.length; i++) { %>
                                            <li class="message">
                                                <img src="https://bootdey.com/img/Content/avatar/avatar1.png" class="online" />
                                                <span class="message-text">
                                                    <a href="javascript:void(0);" class="username">
                                                        <%= reviews[i].name %>
                                                        <span class="badge">Purchase Verified</span>
                                                        <span class="pull-right">
                                                            <% for (var j = 1; j <= 5; j++) { %>
                                                                <% if (reviews[i].rating>=j) {%>
                                                                    <i class="fa fa-star text-primary"></i>
                                                                    <%}else{%>
                                                                        <i class="fa fa-star text-muted"></i>
                                                                    <% } %>
                                                            <%} %>
                                                        </span>
                                                    </a>
                                                    <%= reviews[i].review %>
                                                </span>
                                                <ul class="list-inline font-xs">
                                                    <li class="pull-right">
                                                        <small class="text-muted pull-right ultra-light"> Posted on : <%= new Date(reviews[i].postedOn._seconds*1000).toDateString() %> </small>
                                                    </li>
                                                </ul>
                                            </li>
                                            <br><br>
                                            <% } %>
                                        <%}else{%>
                                        <p>No Reviews Available <br/> Be the first one to post a review </p>
                                        <% } %>
                                    
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>            
            </div>
        </div>
    </div>
<%- include("../partials/footer") %>
<%- include("../partials/end") %>


<script>
addToWishlist=async ()=>{
    if(document.getElementById("fas fa-heart").style.color==="grey"){
        const res= await axios({
                        url:"/addToWishList",
                        method:"POST",
                        data:{
                            productId: document.getElementById('productId').value
                        }
                    })
        document.getElementById("fas fa-heart").style.color="red";
    }else{
        const res= await axios({
                        url:"/removeFromWishList",
                        method:"POST",
                        data:{
                            productId: document.getElementById('productId').value
                        }
                    })
        document.getElementById("fas fa-heart").style.color="grey";
    }
}

if(document.getElementsByClassName('your-review')){
    
    
    var stars = $('#stars li').parent().children('li.star');
    

    for (i = 0; i < +document.getElementById('rating').value; i++) {
      $(stars[i]).addClass('selected');
    }
    
    var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
    document.getElementById('rating').value=ratingValue;
    document.getElementById('rating-warning').innerHTML='';
 
}

 $(document).ready(function(){
     if(!document.getElementsByClassName('your-review')){
    $('#stars li').on('mouseover', function(){
    var onStar = parseInt($(this).data('value'), 10);  $(this).parent().children('li.star').each(function(e){
      if (e < onStar) {
        $(this).addClass('hover');
      }
      else {
        $(this).removeClass('hover');
      }
    });
    
  }).on('mouseout', function(){
    $(this).parent().children('li.star').each(function(e){
      $(this).removeClass('hover');
    });
  });
  
  
 
  $('#stars li').on('click', function(){
    var onStar = parseInt($(this).data('value'), 10); 
    var stars = $(this).parent().children('li.star');
    
    for (i = 0; i < stars.length; i++) {
      $(stars[i]).removeClass('selected');
    }

    for (i = 0; i < onStar; i++) {
      $(stars[i]).addClass('selected');
    }
    
    var ratingValue = parseInt($('#stars li.selected').last().data('value'), 10);
    document.getElementById('rating').value=ratingValue;
    document.getElementById('rating-warning').innerHTML='';
  });
  }
  
  
});

const reviewBox=()=>{
    document.getElementById('review').style.borderColor='#F1F1F1';
}

const submitReviewHandler=async ()=>{
    var productId= document.getElementById('productId').value ;
    
    if(document.getElementById('rating').value===''){
        console.log('lease add star')
        document.getElementById('rating-warning').innerHTML='Please Give A Rating';
    }
    if(!document.getElementById('review').value){
        document.getElementById('review').style.borderColor='red';
    }else{
        const res=await axios({
        method:'POST',
        url:`/user/review/${productId}`,
        data:{
            rating: +document.getElementById('rating').value,
            review: document.getElementById('review').value
        }
    })

    if(res.data.status==='success'){
        location.reload();
    }else{
        console.log(res.data);
    }
    }

    
}
const editReviewHandler=async ()=>{
    var productId= document.getElementById('productId').value ;
    
    if(document.getElementById('rating').value===''){
        console.log('lease add star')
        document.getElementById('rating-warning').innerHTML='Please Give A Rating';
    }
    if(!document.getElementById('review').value){
        document.getElementById('review').style.borderColor='red';
    }else{
        const res=await axios({
        method:'POST',
        url:`/user/review/${productId}`,
        data:{
            
            rating: +document.getElementById('rating').value,
            review: document.getElementById('review').value
        }
    })

    if(res.data.status==='success'){
        location.reload();
    }else{
        console.log(res.data);
    }
    }

    
}



</script>