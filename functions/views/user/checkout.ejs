<%- include("../partials/start") %> <%- include("../partials/headBody") %> <%-
include("../partials/header") %>
<body>
  <% if (alreadyActivePlan) {%>
    <div class="alreadyActivePlan">
      <h1>There's Already an active plan. Enjoy !</h1>
      <br/>
      <p><b>Active Plan:</b> <%= user.packPurchased %></p>
      <p><b>Expires On:</b> <%= new Date(user.expiresOn._seconds*1000).toDateString() %></p>
      
    </div>
   
    <%}else{%>
      <div class="checkout-card">
        <h4 style="padding: 10px;">Order Summary</h4>
        <br />
        <h5 style="color: #9bf6ff;"><%= packageName %> Pack</h5>
        <br />
        <h3 style="font-weight: bold;">₹ <%= amount.amount/100 %>.00</h3>
        <!-- <p>Validity: 1 Month</p> -->
        <br />
        <br />
        <ul style="text-align: left; margin-left: 60px; list-style-type: none;">
          <%if(sellingLimit==='Unlimited'){%>
            <li><i class="fas fa-carrot"></i>Sell <%= sellingLimit %> Number of Products</li>
            <br/>
          <%}
          else{%>
            <li><i class="fas fa-carrot"></i>Sell Upto <%= sellingLimit %> Products</li>
            <br/>
          <%}%>
          <li><i class="fas fa-carrot"></i>Valid For <%= duration %> months</li>
          <br/>
          <li><i class="fas fa-carrot"></i>Get Seller Contact Details </li>
        </ul>
        <br/>
        
        <div class="order-button">
          <button id="rzp-button1">
            Proceed To Pay
          </button>
        </div>
        <input type="hidden" id="key_id" value="<%= key_id  %>" />
        <input type="hidden" id="order_id" value="<%= orderData.id  %>" />
        <input type="hidden" id="amount" value="<%= amount.amount  %>" />
      </div>
    <% } %>
    <br>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    if (document.getElementsByClassName("checkout-card")) {
      var options = {
        key: document.getElementById("key_id").value,
        amount: document.getElementById("amount").value,
        currency: "INR",
        name: "Factory Dukan",
        description: "Package Purchase",
        image: "/images/logo.png",
        order_id: document.getElementById("order_id").value,
        handler: async function (response) {
          const res = await axios({
            method: "POST",
            url: "/user/payment/verify",
            data: {
              response,
              amount: document.getElementById("amount").value,
            },
          });

          if (res.data.status === "success") {
            window.setTimeout(() => {
              location.assign("/user/paymentSuccess");
            }, 0);
          } else {
            console.log("PAYMENT FAILED ☹");
          }
        },
        theme: {
          color: "rgb(247,148,29)",
        },
      };
      var rzp1 = new Razorpay(options);
      document.getElementById("rzp-button1").onclick = function (e) {
        rzp1.open();
        e.preventDefault();
      };
    }
  </script>
</body>
<%- include('../partials/footer.ejs') %> <%- include('../partials/end.ejs') %>
